# Meshesã€FoundationManageã€MeshesTreasury ä¸‰è€…å…³ç³»å®‰å…¨åˆ†æ

## ä¸€ã€å½“å‰æ¶æ„å…³ç³»

### 1. èµ„é‡‘æµå‘ï¼ˆå·²æ›´æ–°ï¼‰
```
Meshes (ä»£å¸åˆçº¦)
  â””â”€> Treasury (è‡ªåŠ¨è½¬è´¦ï¼Œé€šè¿‡ FoundationAddr æŒ‡å‘ Treasury)
      â””â”€> FoundationManage (é€šè¿‡ Safe æ‰‹åŠ¨è½¬è´¦æˆ–è‡ªåŠ¨å¹³è¡¡)
          â””â”€> å…¶ä»–åˆçº¦ (è‡ªåŠ¨è½¬è´¦)
```

**æ–°çš„èµ„é‡‘æµå‘è®¾è®¡**ï¼š
- âœ… Meshes â†’ Treasuryï¼ˆè‡ªåŠ¨ï¼‰ï¼šMeshes åˆçº¦è‡ªåŠ¨å°†åŸºé‡‘ä¼šåˆ†é…è½¬è´¦åˆ° Treasury
- âœ… Treasury â†’ FoundationManageï¼ˆé€šè¿‡ Safe è¡¥å……æˆ–è‡ªåŠ¨å¹³è¡¡ï¼‰ï¼šTreasury è´Ÿè´£å‘ FoundationManage åˆ†é…èµ„é‡‘
- âŒ å·²å–æ¶ˆï¼šMeshes â†’ FoundationManage çš„ç›´æ¥è½¬è´¦

### 2. åˆçº¦å…³ç³»
- **Meshes**: ERC20 ä»£å¸åˆçº¦ï¼Œ`FoundationAddr` æ¥æ”¶åŸºé‡‘ä¼šåˆ†é…
- **MeshesTreasury**: åŸºç¡€å›½åº“ï¼Œä»… Safe å¯è½¬è´¦
- **FoundationManage**: è‡ªåŠ¨è½¬è´¦ç®¡ç†ï¼ŒæŒæœ‰èµ„é‡‘æ± 

## äºŒã€å‘ç°çš„æ½œåœ¨æ¼æ´

### âœ… å·²ä¿®å¤çš„é—®é¢˜

#### 1. **èµ„é‡‘æµå‘å·²ä¼˜åŒ–**ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤å†…å®¹**:
- âœ… Meshes ç°åœ¨ç›´æ¥è½¬è´¦åˆ° Treasuryï¼ˆé€šè¿‡ `FoundationAddr` æŒ‡å‘ Treasuryï¼‰
- âœ… å–æ¶ˆäº† Meshes â†’ FoundationManage çš„ç›´æ¥è½¬è´¦
- âœ… Treasury è´Ÿè´£ç®¡ç†æ‰€æœ‰åŸºé‡‘ä¼šèµ„é‡‘ï¼Œå¹¶å‘ FoundationManage åˆ†é…

**ä¼˜åŠ¿**:
- èµ„é‡‘æµå‘æ›´æ¸…æ™°ï¼šMeshes â†’ Treasury â†’ FoundationManage
- Treasury ä½œä¸ºç»Ÿä¸€çš„èµ„é‡‘ç®¡ç†ä¸­å¿ƒ
- æ›´å¥½çš„èµ„é‡‘æ§åˆ¶å’Œå®¡è®¡è¿½è¸ª

#### 2. **è‡ªåŠ¨å¹³è¡¡åŠŸèƒ½**ï¼ˆå·²æ·»åŠ ï¼‰
**æ–°å¢åŠŸèƒ½**:
- âœ… Treasury æ”¯æŒè‡ªåŠ¨å¹³è¡¡åŠŸèƒ½ï¼ˆ`autoBalanceEnabled`ï¼‰
- âœ… Safe å¯ä»¥éšæ—¶æ‰‹åŠ¨è°ƒç”¨ `balanceFoundationManage()`
- âœ… å¦‚æœå¯ç”¨è‡ªåŠ¨å¹³è¡¡ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§¦å‘å¹³è¡¡ï¼ˆå—é˜ˆå€¼é™åˆ¶ï¼‰
- âœ… å¯è®¾ç½®è‡ªåŠ¨å¹³è¡¡çš„æœ€å°å·®é¢é˜ˆå€¼ï¼ˆ`autoBalanceThreshold`ï¼‰

**ä¼˜åŠ¿**:
- è‡ªåŠ¨åŒ–èµ„é‡‘ç®¡ç†ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œ
- çµæ´»çš„æƒé™æ§åˆ¶ï¼ˆSafe æ‰‹åŠ¨ vs è‡ªåŠ¨å¹³è¡¡ï¼‰

#### 3. **ä½™é¢å¹³è¡¡æœºåˆ¶ä¸å®Œæ•´**
**ä½ç½®**: `MeshesTreasury.sol:225-262`

**é—®é¢˜**:
- `balanceFoundationManage()` åªå¤„ç† Treasury > FoundationManage çš„æƒ…å†µ
- å¦‚æœ Meshes ç›´æ¥è½¬è´¦ç»™ FoundationManageï¼Œå¯èƒ½å¯¼è‡´ FoundationManage ä½™é¢ > Treasury
- æ²¡æœ‰æœºåˆ¶å°†å¤šä½™çš„ FoundationManage ä½™é¢è½¬å› Treasury

**å½±å“**: èµ„é‡‘å¯èƒ½è¿‡åº¦é›†ä¸­åœ¨ FoundationManageï¼ŒTreasury ä½™é¢ä¸è¶³

### ğŸŸ¡ ä¸­ç­‰é—®é¢˜

#### 4. **ç¼ºå°‘ç´§æ€¥æå–æœºåˆ¶**
**é—®é¢˜**:
- FoundationManage å¦‚æœè¢«æ”»å‡»æˆ–é…ç½®é”™è¯¯ï¼Œèµ„é‡‘æ— æ³•å¿«é€Ÿæå–
- Treasury æ— æ³•ç›´æ¥ä» FoundationManage æå–èµ„é‡‘ï¼ˆåªèƒ½è½¬è´¦åˆ° FoundationManageï¼‰

**å»ºè®®**: æ·»åŠ ç´§æ€¥æå–åŠŸèƒ½ï¼ˆéœ€è¦ Safe å¤šç­¾ï¼‰

#### 5. **ç¼ºå°‘ä½™é¢ç›‘æ§å’Œå‘Šè­¦**
**é—®é¢˜**:
- æ²¡æœ‰æœºåˆ¶ç›‘æ§ FoundationManage ä½™é¢æ˜¯å¦è¿‡ä½
- æ²¡æœ‰è‡ªåŠ¨è¡¥å……æœºåˆ¶ï¼ˆéœ€è¦æ‰‹åŠ¨è°ƒç”¨ balanceFoundationManageï¼‰

**å»ºè®®**: æ·»åŠ ä½™é¢ç›‘æ§å’Œè‡ªåŠ¨è¡¥å……åŠŸèƒ½

#### 6. **æƒé™åˆ†ç¦»ä¸å½»åº•**
**é—®é¢˜**:
- FoundationManage çš„ Owner å’Œ Treasury çš„ Owner å¯èƒ½ä¸åŒ
- å¦‚æœä¸¤è€…ä¸åŒï¼Œå¯èƒ½å¯¼è‡´é…ç½®ä¸ä¸€è‡´

**å»ºè®®**: ç¡®ä¿ä¸¤ä¸ªåˆçº¦çš„ Owner æ˜¯åŒä¸€ä¸ª Safe æˆ–ç›¸å…³åœ°å€

### ğŸŸ¢ æ”¹è¿›å»ºè®®

#### 7. **ç¼ºå°‘èµ„é‡‘æµè¿½è¸ª**
**å»ºè®®**: æ·»åŠ æ›´è¯¦ç»†çš„äº‹ä»¶è®°å½•ï¼Œè¿½è¸ªæ‰€æœ‰èµ„é‡‘æµåŠ¨

#### 8. **ç¼ºå°‘æœ€å¤§ä½™é¢é™åˆ¶**
**å»ºè®®**: ä¸º FoundationManage è®¾ç½®æœ€å¤§ä½™é¢é™åˆ¶ï¼Œé˜²æ­¢èµ„é‡‘è¿‡åº¦é›†ä¸­

#### 9. **ç¼ºå°‘æœ€å°ä½™é¢é˜ˆå€¼**
**å»ºè®®**: è®¾ç½®æœ€å°ä½™é¢é˜ˆå€¼ï¼Œä½äºé˜ˆå€¼æ—¶è‡ªåŠ¨ä» Treasury è¡¥å……

## ä¸‰ã€éœ€è¦å¢åŠ çš„åŠŸèƒ½

### 1. **ä¿®å¤ Meshes ç™½åå•æ£€æŸ¥**
```solidity
// åº”è¯¥å¼•ç”¨ Treasury åˆçº¦ï¼Œè€Œä¸æ˜¯ FoundationAddr
function _isApprovedByCurrentTreasury(address candidate) internal view returns (bool) {
    // éœ€è¦æ·»åŠ  Treasury åœ°å€å¼•ç”¨
    // è°ƒç”¨ Treasury.isRecipientApproved(candidate)
}
```

### 2. **Treasury æ·»åŠ ç´§æ€¥æå–åŠŸèƒ½**
```solidity
// å…è®¸ Safe ä» FoundationManage æå–èµ„é‡‘ï¼ˆç´§æ€¥æƒ…å†µï¼‰
function emergencyWithdrawFromFoundation(uint256 amount) external onlySafeExec;
```

### 3. **FoundationManage æ·»åŠ ä½™é¢ç›‘æ§**
```solidity
// è®¾ç½®æœ€å°ä½™é¢é˜ˆå€¼
uint256 public minBalance;
// å½“ä½™é¢ä½äºé˜ˆå€¼æ—¶ï¼Œè§¦å‘äº‹ä»¶æˆ–è‡ªåŠ¨è¡¥å……
```

### 4. **æ·»åŠ èµ„é‡‘æµéªŒè¯**
```solidity
// Meshes è½¬è´¦å‰æ£€æŸ¥ FoundationManage çŠ¶æ€
// ç¡®ä¿ FoundationManage æœªæš‚åœä¸”èƒ½æ¥æ”¶èµ„é‡‘
```

### 5. **åŒå‘ä½™é¢å¹³è¡¡**
```solidity
// ä¸ä»…ä» Treasury å‘ FoundationManage è½¬è´¦
// ä¹Ÿå¯ä»¥ä» FoundationManage å‘ Treasury è½¬è´¦ï¼ˆå¦‚æœä½™é¢è¿‡é«˜ï¼‰
```

## å››ã€æ¨èçš„å®‰å…¨æªæ–½

1. **ç»Ÿä¸€æƒé™ç®¡ç†**: ç¡®ä¿ Treasury å’Œ FoundationManage çš„ Owner æ˜¯åŒä¸€ä¸ª Safe
2. **æ·»åŠ æš‚åœæ£€æŸ¥**: Meshes è½¬è´¦å‰æ£€æŸ¥ FoundationManage æ˜¯å¦æš‚åœ
3. **è®¾ç½®ä½™é¢é™åˆ¶**: ä¸º FoundationManage è®¾ç½®æœ€å¤§å’Œæœ€å°ä½™é¢
4. **å®Œå–„äº‹ä»¶è®°å½•**: è®°å½•æ‰€æœ‰å…³é”®æ“ä½œï¼Œä¾¿äºå®¡è®¡
5. **æ·»åŠ æ—¶é—´é”**: å¯¹å…³é”®é…ç½®å˜æ›´æ·»åŠ æ—¶é—´é”
6. **å®šæœŸå®¡è®¡**: å®šæœŸæ£€æŸ¥ä¸‰ä¸ªåˆçº¦çš„é…ç½®ä¸€è‡´æ€§

## äº”ã€ä¿®å¤ä¼˜å…ˆçº§

1. **P0 (ç«‹å³ä¿®å¤)**: Meshes ç™½åå•æ£€æŸ¥é€»è¾‘é”™è¯¯
2. **P1 (é«˜ä¼˜å…ˆçº§)**: æ·»åŠ ä½™é¢ç›‘æ§å’Œè‡ªåŠ¨è¡¥å……
3. **P2 (ä¸­ä¼˜å…ˆçº§)**: æ·»åŠ ç´§æ€¥æå–åŠŸèƒ½
4. **P3 (ä½ä¼˜å…ˆçº§)**: å®Œå–„äº‹ä»¶è®°å½•å’Œç›‘æ§

